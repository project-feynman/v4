var Se=Object.defineProperty;var K=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var x=(o,e,r)=>e in o?Se(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,C=(o,e)=>{for(var r in e||(e={}))Re.call(e,r)&&x(o,r,e[r]);if(K)for(var r of K(e))Ie.call(e,r)&&x(o,r,e[r]);return o};import{S as B,i as q,s as M,E as Pe,F as Fe,G as ze,H as Le,x as _,u as p,e as V,k as P,c as E,a as W,d as h,n as F,a8 as ee,b as G,a6 as H,f as b,D as N,a9 as te,a0 as X,X as re,aa as Ue,ab as ne,A as le,a2 as Y,ac as Ve,ad as Ee,I as We,j as T,t as Z,m as S,g as O,o as R,W as oe,ae as je,v as I,l as j,w as L,Y as Ne,af as Ce,U as se,V as ie,r as U,Z as Be,h as qe,ag as Me,ah as Ye}from"../../chunks/vendor-0c076a04.js";import{f as Ze,a as ae,s as Oe,d as fe}from"../../chunks/database-90b86ea3.js";import{r as ce,c as ue,L as Qe,B as de}from"../../chunks/LeftDrawer-4805f2b8.js";import{p as me}from"../../chunks/actions-c4e01d0d.js";import{r as Ge}from"../../chunks/singletons-12a22614.js";const He=o=>({boardDoc:o&2,isFetchingStrokes:o&1,strokesArray:o&4}),_e=o=>({boardDoc:o[1],fetchStrokes:o[3],isFetchingStrokes:o[0],strokesArray:o[2]});function Xe(o){let e;const r=o[6].default,t=Pe(r,o,o[5],_e);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,l){t&&t.m(n,l),e=!0},p(n,[l]){t&&t.p&&(!e||l&39)&&Fe(t,r,n,n[5],e?Le(r,n[5],l,He):ze(n[5]),_e)},i(n){e||(_(t,n),e=!0)},o(n){p(t,n),e=!1},d(n){t&&t.d(n)}}}function Je(o,e,r){let{$$slots:t={},$$scope:n}=e,{dbPath:l}=e,f=!1,i,s;async function a(){const u=await Ze(l);r(1,i=u)}a();async function c(){r(0,f=!0),console.log("intersection triggered fetchStrokes()"),r(2,s=await ae(l+"/strokes"))}return o.$$set=u=>{"dbPath"in u&&r(4,l=u.dbPath),"$$scope"in u&&r(5,n=u.$$scope)},[f,i,s,c,l,n,t]}class Ke extends B{constructor(e){super();q(this,e,Je,Xe,M,{dbPath:4})}}function xe(o){let e,r,t,n,l,f,i;return{c(){e=V("canvas"),t=P(),n=V("audio"),this.h()},l(s){e=E(s,"CANVAS",{});var a=W(e);a.forEach(h),t=F(s),n=E(s,"AUDIO",{src:!0,style:!0});var c=W(n);c.forEach(h),this.h()},h(){ee(n.src,l=o[1])||G(n,"src",l),n.controls=!0,H(n,"width","100%")},m(s,a){b(s,e,a),o[6](e),b(s,t,a),b(s,n,a),o[7](n),f||(i=[N(r=ce.call(null,e,{strokesArray:o[0],handleResize:o[5]})),te(e,"resized",o[5]),te(n,"play",o[4])],f=!0)},p(s,[a]){r&&X(r.update)&&a&1&&r.update.call(null,{strokesArray:s[0],handleResize:s[5]}),a&2&&!ee(n.src,l=s[1])&&G(n,"src",l)},i:re,o:re,d(s){s&&h(e),o[6](null),s&&h(t),s&&h(n),o[7](null),f=!1,Ue(i)}}}let et=1;function tt(o){return(o.endTime-o.startTime)/o.points.length}function rt(o,e,r){let{strokesArray:t}=e,{audioDownloadURL:n}=e,l,f=0,i,s,a,c;ne(()=>{c&&clearTimeout(c)}),le(()=>{s=i.getContext("2d");const m=[];for(let y=0;y<t.length;y++)for(let w=1;w<t[y].points.length;w++){const Q={strokeIndex:y,pointIndex:w};m.push(C({startTime:u(Q)},Q))}l=m.sort((y,w)=>y.startTime-w.startTime)});function u({strokeIndex:m,pointIndex:y}){const w=t[m];return w.startTime+(y-1)*tt(w)}function g(){f=0,s.clearRect(0,0,i.width,i.height),z()}function z(){if(!!a&&(k(),f<l.length)){const m=l[f],y=1e3*(m.startTime-a.currentTime);c=setTimeout(z,y/et)}}function k(){if(!a)return;const m=l[f];(!m||m.startTime>a.currentTime)&&(s.clearRect(0,0,i.width,i.height),f=0),v()}function v(){const{currentTime:m}=a;for(let y=f;y<l.length;y++){const w=l[y];if(w.startTime>m)break;A(w),f+=1}}function A({strokeIndex:m,pointIndex:y}){const w=t[m],Te=w.lineWidth*(i.scrollWidth/1e3);ue(w.points,y,w.isErasing,s,w.color,Te,i)}function d(){return new Promise(async m=>{c?(f=0,this.syncStrokesToAudio()):this.renderFramesUntilCurrentTime(),m()})}function $(m){Y[m?"unshift":"push"](()=>{i=m,r(2,i)})}function D(m){Y[m?"unshift":"push"](()=>{a=m,r(3,a)})}return o.$$set=m=>{"strokesArray"in m&&r(0,t=m.strokesArray),"audioDownloadURL"in m&&r(1,n=m.audioDownloadURL)},[t,n,i,a,g,d,$,D]}class nt extends B{constructor(e){super();q(this,e,rt,xe,M,{strokesArray:0,audioDownloadURL:1})}}function lt(o){let e;return{c(){e=Z("Play")},l(r){e=O(r,"Play")},m(r,t){b(r,e,t)},d(r){r&&h(e)}}}function ot(o){let e,r,t,n,l,f,i,s,a,c,u,g,z,k;function v(d){o[7](d)}let A={min:0,max:o[2].length+1,step:1,discrete:!0,"input$aria-label":"Discrete slider"};return o[3]!==void 0&&(A.value=o[3]),n=new Ve({props:A}),Y.push(()=>Ee(n,"value",v)),i=new We({props:{$$slots:{default:[lt]},$$scope:{ctx:o}}}),i.$on("click",o[4]),{c(){e=V("canvas"),t=P(),T(n.$$.fragment),f=P(),T(i.$$.fragment),s=P(),a=V("pre"),c=Z("Value: "),u=Z(pe),this.h()},l(d){e=E(d,"CANVAS",{});var $=W(e);$.forEach(h),t=F(d),S(n.$$.fragment,d),f=F(d),S(i.$$.fragment,d),s=F(d),a=E(d,"PRE",{class:!0});var D=W(a);c=O(D,"Value: "),u=O(D,pe),D.forEach(h),this.h()},h(){G(a,"class","status")},m(d,$){b(d,e,$),o[6](e),b(d,t,$),R(n,d,$),b(d,f,$),R(i,d,$),b(d,s,$),b(d,a,$),oe(a,c),oe(a,u),g=!0,z||(k=N(r=ce.call(null,e,{strokesArray:o[0],onResize:o[5]})),z=!0)},p(d,[$]){r&&X(r.update)&&$&1&&r.update.call(null,{strokesArray:d[0],onResize:d[5]});const D={};$&4&&(D.max=d[2].length+1),!l&&$&8&&(l=!0,D.value=d[3],je(()=>l=!1)),n.$set(D);const m={};$&2048&&(m.$$scope={dirty:$,ctx:d}),i.$set(m)},i(d){g||(_(n.$$.fragment,d),_(i.$$.fragment,d),g=!0)},o(d){p(n.$$.fragment,d),p(i.$$.fragment,d),g=!1},d(d){d&&h(e),o[6](null),d&&h(t),I(n,d),d&&h(f),I(i,d),d&&h(s),d&&h(a),z=!1,k()}}}let he=1,pe=0;function st(o,e,r){let{strokesArray:t}=e,n,l,f=[],i=0,s;ne(()=>{s&&clearTimeout(s)}),le(()=>{l=n.getContext("2d");const k=[];for(let v=0;v<t.length;v++)for(let A=1;A<t[v].points.length;A++){const d={strokeIndex:v,pointIndex:A};k.push(d)}r(2,f=k)});async function a(){if(console.log("sync recursively"),console.log("nextFrameIdx =",i),console.log("allFrames =",f),i<f.length){for(let v=0;v<=i;v++)await u(f[v],!0);const k=1e3;r(3,i+=5),s=setTimeout(a,k/he)}}async function c(){console.log("resized"),l.clearRect(0,0,n.width,n.height);for(let k=0;k<=i;k++)await u(f[k],!0)}async function u({strokeIndex:k,pointIndex:v},A=!1){const d=t[k],D=d.lineWidth*(n.scrollWidth/1e3);ue(d.points,v,d.isErasing,l,d.color,D,n),A||await new Promise(m=>setTimeout(m,10/he))}function g(k){Y[k?"unshift":"push"](()=>{n=k,r(1,n)})}function z(k){i=k,r(3,i)}return o.$$set=k=>{"strokesArray"in k&&r(0,t=k.strokesArray)},[t,n,f,i,a,c,g,z]}class it extends B{constructor(e){super();q(this,e,st,ot,M,{strokesArray:0})}}const at=Ge,ft=ct;async function ct(o,e){return at.goto(o,e,[])}function ke(o,e,r){const t=o.slice();return t[6]=e[r],t}function ge(o,e,r){const t=o.slice();return t[2]=e[r],t}function be(o){let e,r,t,n,l,f=o[1],i=[];for(let a=0;a<f.length;a+=1)i[a]=ye(ge(o,f,a));const s=a=>p(i[a],1,1,()=>{i[a]=null});return{c(){e=V("div");for(let a=0;a<i.length;a+=1)i[a].c()},l(a){e=E(a,"DIV",{});var c=W(e);for(let u=0;u<i.length;u+=1)i[u].l(c);c.forEach(h)},m(a,c){b(a,e,c);for(let u=0;u<i.length;u+=1)i[u].m(e,null);t=!0,n||(l=N(r=me.call(null,e,"side-drawer-list")),n=!0)},p(a,c){if(c&11){f=a[1];let u;for(u=0;u<f.length;u+=1){const g=ge(a,f,u);i[u]?(i[u].p(g,c),_(i[u],1)):(i[u]=ye(g),i[u].c(),_(i[u],1),i[u].m(e,null))}for(U(),u=f.length;u<i.length;u+=1)s(u);L()}},i(a){if(!t){for(let c=0;c<f.length;c+=1)_(i[c]);t=!0}},o(a){i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)p(i[c]);t=!1},d(a){a&&h(e),Ne(i,a),n=!1,l()}}}function $e(o){let e,r;function t(){return o[4](o[2])}return e=new Be({props:{selected:o[2].id===o[0],$$slots:{default:[ut]},$$scope:{ctx:o}}}),e.$on("click",t),{c(){T(e.$$.fragment)},l(n){S(e.$$.fragment,n)},m(n,l){R(e,n,l),r=!0},p(n,l){o=n;const f={};l&3&&(f.selected=o[2].id===o[0]),l&32770&&(f.$$scope={dirty:l,ctx:o}),e.$set(f)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){p(e.$$.fragment,n),r=!1},d(n){I(e,n)}}}function ut(o){let e=o[2].name+"",r,t;return{c(){r=Z(e),t=P()},l(n){r=O(n,e),t=F(n)},m(n,l){b(n,r,l),b(n,t,l)},p(n,l){l&2&&e!==(e=n[2].name+"")&&qe(r,e)},d(n){n&&h(r),n&&h(t)}}}function ye(o){let e,r,t=o[2].name&&$e(o);return{c(){t&&t.c(),e=j()},l(n){t&&t.l(n),e=j()},m(n,l){t&&t.m(n,l),b(n,e,l),r=!0},p(n,l){n[2].name?t?(t.p(n,l),l&2&&_(t,1)):(t=$e(n),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(U(),p(t,1,1,()=>{t=null}),L())},i(n){r||(_(t),r=!0)},o(n){p(t),r=!1},d(n){t&&t.d(n),n&&h(e)}}}function we(o){let e,r=[],t=new Map,n,l,f,i,s=o[2].blackboards;const a=c=>c[6];for(let c=0;c<s.length;c+=1){let u=ke(o,s,c),g=a(u);t.set(g,r[c]=De(g,u))}return{c(){e=V("div");for(let c=0;c<r.length;c+=1)r[c].c();this.h()},l(c){e=E(c,"DIV",{style:!0});var u=W(e);for(let g=0;g<r.length;g+=1)r[g].l(u);u.forEach(h),this.h()},h(){H(e,"height","100vh")},m(c,u){b(c,e,u);for(let g=0;g<r.length;g+=1)r[g].m(e,null);l=!0,f||(i=N(n=me.call(null,e,"main-content")),f=!0)},p(c,u){u&7684&&(s=c[2].blackboards,U(),r=Ce(r,u,a,1,c,s,t,e,Me,De,null,ke),L())},i(c){if(!l){for(let u=0;u<s.length;u+=1)_(r[u]);l=!0}},o(c){for(let u=0;u<r.length;u+=1)p(r[u]);l=!1},d(c){c&&h(e);for(let u=0;u<r.length;u+=1)r[u].d();f=!1,i()}}}function dt(o){let e,r,t,n;const l=[pt,ht,_t],f=[];function i(s,a){return s[9].audioDownloadURL?0:s[9].creator?1:2}return e=i(o),r=f[e]=l[e](o),{c(){r.c(),t=j()},l(s){r.l(s),t=j()},m(s,a){f[e].m(s,a),b(s,t,a),n=!0},p(s,a){let c=e;e=i(s),e===c?f[e].p(s,a):(U(),p(f[c],1,1,()=>{f[c]=null}),L(),r=f[e],r?r.p(s,a):(r=f[e]=l[e](s),r.c()),_(r,1),r.m(t.parentNode,t))},i(s){n||(_(r),n=!0)},o(s){p(r),n=!1},d(s){f[e].d(s),s&&h(t)}}}function mt(o){let e,r,t,n,l,f,i,s=o[11]&&ve(o);return t=new de({props:{strokesArray:[]}}),{c(){s&&s.c(),e=P(),r=V("div"),T(t.$$.fragment),this.h()},l(a){s&&s.l(a),e=F(a),r=E(a,"DIV",{style:!0});var c=W(r);S(t.$$.fragment,c),c.forEach(h),this.h()},h(){H(r,"height","500px")},m(a,c){s&&s.m(a,c),b(a,e,c),b(a,r,c),R(t,r,null),l=!0,f||(i=N(n=bt.call(null,r,o[10])),f=!0)},p(a,c){a[11]?s?(s.p(a,c),c&2048&&_(s,1)):(s=ve(a),s.c(),_(s,1),s.m(e.parentNode,e)):s&&(U(),p(s,1,1,()=>{s=null}),L()),n&&X(n.update)&&c&1024&&n.update.call(null,a[10])},i(a){l||(_(s),_(t.$$.fragment,a),l=!0)},o(a){p(s),p(t.$$.fragment,a),l=!1},d(a){s&&s.d(a),a&&h(e),a&&h(r),I(t),f=!1,i()}}}function _t(o){let e,r;return e=new de({props:{strokesArray:o[12]}}),{c(){T(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,n){R(e,t,n),r=!0},p(t,n){const l={};n&4096&&(l.strokesArray=t[12]),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ht(o){let e,r;return e=new it({props:{strokesArray:o[12]}}),{c(){T(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,n){R(e,t,n),r=!0},p(t,n){const l={};n&4096&&(l.strokesArray=t[12]),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function pt(o){let e,r;return e=new nt({props:{strokesArray:o[12],audioDownloadURL:o[9].audioDownloadURL}}),{c(){T(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,n){R(e,t,n),r=!0},p(t,n){const l={};n&4096&&(l.strokesArray=t[12]),n&512&&(l.audioDownloadURL=t[9].audioDownloadURL),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function ve(o){let e,r;return e=new Ye({props:{isFetchingStrokes:o[11],indeterminate:!0}}),{c(){T(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,n){R(e,t,n),r=!0},p(t,n){const l={};n&2048&&(l.isFetchingStrokes=t[11]),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){I(e,t)}}}function kt(o){let e,r,t,n;const l=[mt,dt],f=[];function i(s,a){return s[12]?s[9]?1:-1:0}return~(e=i(o))&&(r=f[e]=l[e](o)),{c(){r&&r.c(),t=P()},l(s){r&&r.l(s),t=F(s)},m(s,a){~e&&f[e].m(s,a),b(s,t,a),n=!0},p(s,a){let c=e;e=i(s),e===c?~e&&f[e].p(s,a):(r&&(U(),p(f[c],1,1,()=>{f[c]=null}),L()),~e?(r=f[e],r?r.p(s,a):(r=f[e]=l[e](s),r.c()),_(r,1),r.m(t.parentNode,t)):r=null)},i(s){n||(_(r),n=!0)},o(s){p(r),n=!1},d(s){~e&&f[e].d(s),s&&h(t)}}}function De(o,e){let r,t,n;return t=new Ke({props:{dbPath:Ae+e[6],$$slots:{default:[kt,({boardDoc:l,fetchStrokes:f,isFetchingStrokes:i,strokesArray:s})=>({9:l,10:f,11:i,12:s}),({boardDoc:l,fetchStrokes:f,isFetchingStrokes:i,strokesArray:s})=>(l?512:0)|(f?1024:0)|(i?2048:0)|(s?4096:0)]},$$scope:{ctx:e}}}),{key:o,first:null,c(){r=j(),T(t.$$.fragment),this.h()},l(l){r=j(),S(t.$$.fragment,l),this.h()},h(){this.first=r},m(l,f){b(l,r,f),R(t,l,f),n=!0},p(l,f){e=l;const i={};f&4&&(i.dbPath=Ae+e[6]),f&40448&&(i.$$scope={dirty:f,ctx:e}),t.$set(i)},i(l){n||(_(t.$$.fragment,l),n=!0)},o(l){p(t.$$.fragment,l),n=!1},d(l){l&&h(r),I(t,l)}}}function gt(o){let e,r,t,n,l=o[1].length>0&&be(o),f=o[2]&&we(o);return t=new Qe({}),{c(){l&&l.c(),e=P(),f&&f.c(),r=P(),T(t.$$.fragment)},l(i){l&&l.l(i),e=F(i),f&&f.l(i),r=F(i),S(t.$$.fragment,i)},m(i,s){l&&l.m(i,s),b(i,e,s),f&&f.m(i,s),b(i,r,s),R(t,i,s),n=!0},p(i,[s]){i[1].length>0?l?(l.p(i,s),s&2&&_(l,1)):(l=be(i),l.c(),_(l,1),l.m(e.parentNode,e)):l&&(U(),p(l,1,1,()=>{l=null}),L()),i[2]?f?(f.p(i,s),s&4&&_(f,1)):(f=we(i),f.c(),_(f,1),f.m(r.parentNode,r)):f&&(U(),p(f,1,1,()=>{f=null}),L())},i(i){n||(_(l),_(f),_(t.$$.fragment,i),n=!0)},o(i){p(l),p(f),p(t.$$.fragment,i),n=!1},d(i){l&&l.d(i),i&&h(e),f&&f.d(i),i&&h(r),I(t,i)}}}async function St({page:o}){return console.log("page =",o),{props:{roomID:o.params.id}}}const Ae="classes/lvzQqyZIV1wjwYnRV9hn/blackboards/",J="classes/lvzQqyZIV1wjwYnRV9hn/rooms/";function bt(o,e){new IntersectionObserver(t=>{for(const n of t)if(n.isIntersecting){e();return}},{root:null,threshold:.1,rootMargin:"0px"}).observe(o)}function $t(o,e,r){let{roomID:t}=e,n,l=[];function f(a,c=!1){ft(`/${a}`,{replaceState:c})}Oe.subscribe(async a=>{if(console.log("new user value was set =",a),a){r(1,l=await ae(J));const c=await se(ie(fe,J+t));r(2,n=C({id:c.id},c.data())),console.log("roomDoc =",n)}});async function i(){const a=await se(ie(fe,J+t));r(2,n=C({id:a.id},a.data()))}const s=a=>f(`room/${a.id}`);return o.$$set=a=>{"roomID"in a&&r(0,t=a.roomID)},o.$$.update=()=>{o.$$.dirty&1&&i()},[t,l,n,f,s]}class Rt extends B{constructor(e){super();q(this,e,$t,gt,M,{roomID:0})}}export{Rt as default,St as load};
